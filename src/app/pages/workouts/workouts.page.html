<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>{{ 'workouts.title' | translate }}</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <section class="flex h-full flex-col px-6 py-6">
    @if (error()) {
      <div class="mb-4 rounded-lg bg-red-500/10 border border-red-500/20 px-4 py-3">
        <p class="text-sm text-red-400">{{ error() }}</p>
      </div>
    }

    @if (isLoadingWorkouts()) {
      <div class="flex flex-1 items-center justify-center">
        <ion-spinner name="crescent" class="text-primary"></ion-spinner>
      </div>
    } @else if (hasWorkouts()) {
      <div class="flex flex-1 flex-col gap-6">
        <div class="flex flex-col gap-3">
          @for (workout of workouts(); track trackWorkoutById($index, workout)) {
            <jym-workout-card
              [workout]="workout"
              [exercisesCountText]="getExercisesCountText(workout.exercises.length)"
              [isLoading]="isLoading()"
              (playClick)="onLaunchWorkout($event)"
              (menuClick)="onOpenMenu($event)"
            ></jym-workout-card>
          }
        </div>
      </div>
    } @else {
      <div class="flex flex-1 flex-col items-center justify-center gap-6 text-center">
        <div class="space-y-3 px-4">
          <h2 class="text-2xl font-semibold">{{ 'workouts.welcome.title' | translate }}</h2>
          <p class="text-sm">
            {{ 'workouts.welcome.description' | translate }}
          </p>
        </div>
      </div>
    }
    @if (!isLoadingWorkouts()) {
      <div class="flex justify-end">
        <jym-button
          mode="transparent"
          icon="log-out-outline"
          class="flex-1"
          (click)="onLogout()"
        >
         {{ 'workouts.actions.logout' | translate }}
        </jym-button>
        <jym-button
          mode="primary"
          icon="add-outline"
          [disabled]="isLoading()"
          (click)="onCreateWorkout()"
          class="w-1/2"
        >
          {{ 'workouts.actions.create' | translate }}
        </jym-button>
      </div>
    }
  </section>
</ion-content>

<ion-modal [isOpen]="isWorkoutModalOpen()" (willDismiss)="closeWorkoutModal()">
  <ng-template>
    <div class="flex flex-row justify-end items-center safe-area-top pr-4 bg-default">
      <ion-buttons>
        <ion-button (click)="closeWorkoutModal()">
          <ion-icon name="close" slot="icon-only"></ion-icon>
        </ion-button>
      </ion-buttons>
    </div>
    <ion-content class="bg-default">
      <jym-workout-form
        [workout]="editingWorkout()"
        (createWorkout)="onWorkoutCreated($event)"
        (updateWorkout)="onWorkoutUpdated($event)"
      ></jym-workout-form>
    </ion-content>
  </ng-template>
</ion-modal>
